var a=Object.assign;var u=(s,n,e)=>new Promise((t,c)=>{var y=i=>{try{d(e.next(i))}catch(h){c(h)}},o=i=>{try{d(e.throw(i))}catch(h){c(h)}},d=i=>i.done?t(i.value):Promise.resolve(i.value).then(y,o);d((e=e.apply(s,n)).next())});import g from"querystring-number";var f={},m=(t,c,...y)=>u(void 0,[t,c,...y],function*(s,n,e={}){if(typeof window=="undefined")return;let o;e.method==="GET"?s+="?"+g.stringify(o):o=n&&JSON.stringify(n);let d=(e.baseUrl||"")+s,i=d+o;if(e.cacheTime){let r=f[i];if(r&&Date.now()-r.time<e.cacheTime)return r}let h=Object.prototype.toString.call(n)==="[object FormData]";return e.headers||(e.headers={}),e.headers["Content-Type"]||(h?e.headers["Content-Type"]="application/x-www-form-urlencoded":e.headers["Content-Type"]="application/json"),e.method==="GET"&&!e.headers["Cache-Control"]&&(e.headers["Cache-Control"]="public, max-age=604800, immutable"),fetch(d,a(a({body:o},e),{headers:e.headers})).then(r=>u(void 0,null,function*(){return{body:yield r[e.format||"json"](),status:r.status,headers:r.headers}})).then(r=>u(void 0,null,function*(){return e.cacheTime&&(f[i]={data:r,time:Date.now()}),e.reduce&&(r=yield Promise.resolve(e.reduce(r))),e.onSuccess&&(yield Promise.resolve(e.onSuccess(r))),r})).catch(r=>u(void 0,null,function*(){e.onError&&(yield Promise.resolve(e.onError(r)))}))}),l=(s={})=>({get:(n,e,t)=>m(n,e,a(a(a({},s),t),{method:"GET"})),post:(n,e,t)=>m(n,e,a(a(a({},s),t),{method:"POST"})),del:(n,e,t)=>m(n,e,a(a(a({},s),t),{method:"DELETE"})),options:(n,e,t)=>m(n,e,a(a(a({},s),t),{method:"OPTIONS"}))}),T=(s,n)=>{let e=l({onError:n});return new Proxy({},{get(c,y){return c[y]||(c[y]=o=>e.post(s+"/"+y,o)),c[y]}})};export{m as baseApi,l as createHttp,T as createZeroApi};
